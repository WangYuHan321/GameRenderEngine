#pragma once

#include <ft2build.h> 
#include <freetype/freetype.h>
#include <freetype/ftglyph.h>
#include "../../Util/common.h"

class Texture;
class Font {
public:
    Texture* font_texture() { return font_texture_; }

    /// freetype为字符生成bitmap
    /// \param c
    void LoadCharacter(char ch);

    /// 记录单个字符在图集上的坐标、宽高，用于生成同尺寸的顶点数据，1：1渲染。
    struct Character {
        float left_top_x_;
        float left_top_y_;
        float right_bottom_x_;
        float right_bottom_y_;
        char ch_font_;
        Character(float left_top_x, float left_top_y, float right_bottom_x, float right_bottom_y, char ch) {
            left_top_x_ = left_top_x;
            left_top_y_ = left_top_y;
            right_bottom_x_ = right_bottom_x;
            right_bottom_y_ = right_bottom_y;
            ch_font_ = ch;
        }
    };

    /// 为字符串生成bitmap，返回字符串每个字符的Character数据。
    /// \param str
    /// \return
    std::vector<Character*> LoadStr(std::string str);

private:
    unsigned short font_size_ = 20;//默认字体大小
    char* font_file_buffer_ = nullptr;//ttf字体文件加载到内存
    FT_Library ft_library_;
    FT_Face ft_face_;
    Texture* font_texture_;
    unsigned short font_texture_size_ = 1024;
    unsigned short font_texture_fill_x = 0;//
    unsigned short font_texture_fill_y = 0;
    std::unordered_map<char, Character*> character_map_;//已经生成bitmap的字符

public:
    /// 加载一个字体文件并解析
    /// \param image_file_path ttf字体文件路径
    /// \param font_size 默认文字尺寸
    /// \return
    static Font* LoadFromFile(std::string font_file_path, unsigned short font_size);

    /// 获取Font实例
    /// \param font_file_path ttf路径
    /// \return
    static Font* GetFont(std::string font_file_path);
private:
    static std::unordered_map<std::string, Font*> font_map_;//存储加载的字体 key：ttf路径 value：Font实例
};

